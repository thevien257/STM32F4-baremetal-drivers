#include <stdint.h>
#include <main.h>

GPIO_Handle_TypeDef gpio_handle;
TIM_HandleTypeDef tim_handle;

void GPIO_USER_INIT(void);
void TIMER_USER_INIT(void);

int main(void) {
	GPIO_USER_INIT();
	TIMER_USER_INIT();
	while (1) {
		GPIO_OUTPUT(GPIOA, GPIO_PIN_8, HIGH);
		delay_ms(&tim_handle, 1000);
		GPIO_OUTPUT(GPIOA, GPIO_PIN_8, LOW);
		delay_ms(&tim_handle, 1000);
	}
}

void GPIO_USER_INIT(void) {
	gpio_handle.GPIOX = GPIOA;
	gpio_handle.pin_number = GPIO_PIN_8;
	gpio_handle.mode = GPIO_MODE_OUTPUT;
	gpio_handle.output_speed = GPIO_OUTPUT_SPEED_VERY_HIGH;
	gpio_handle.output_type = GPIO_OUTPUT_TYPE_PP;
	gpio_handle.pull_up_pull_down = GPIO_PUPD_NONE;
	GPIO_INIT(&gpio_handle);
}

void TIMER_USER_INIT(void) {
	tim_handle.TIMx = TIM2;
	tim_handle.autoReload = 0xFFFF;
	tim_handle.autoReloadPreload = LOW;   // ✓ Or HIGH, depending on your needs
	tim_handle.directionCounter = TIM_COUNT_UP;
	tim_handle.prescaler = 15;            // ✓ 16MHz / 16 = 1MHz (1μs per tick)
	tim_handle.updateDisable = LOW;       // ✓ Enable update events!
	tim_handle.updateRequestSource = LOW; // ✓ Allow all update sources
	TIM_INIT(&tim_handle);
}
